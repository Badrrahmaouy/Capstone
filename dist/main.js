var Client;(()=>{"use strict";var e={d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};async function a(e){const t=await fetch(e);try{return await t.json()}catch(e){console.log("error",e)}}e.r(t),e.d(t,{formHandler:()=>c});async function n(e){a("https://pixabay.com/api/?key=20560827-2583a0c3f9bf9a098c0a43c8e&q="+e+"&image_type=photo").then((e=>{const t=e.hits[0].webformatURL;document.getElementById("img").src=t}))}async function o(e="",t={}){const a=await fetch(e,{method:"POST",credentials:"same-origin",headers:{"Content-type":"application/json"},body:JSON.stringify(t)});try{return await a.json()}catch(e){console.log("error",e)}}const r="&key=6ee45688665343cfaaea8d2cd299528a";function c(e){e.preventDefault(),console.log(":::FORM SUBMITTED:::");let t=document.getElementById("address").value;const c=document.getElementById("date_dep").value,l=document.getElementById("date_ret").value,s=parseInt(c[8]+c[9]),u=parseInt(c[5]+c[6]),y=parseInt(c[0]+c[1]+c[2]+c[3]),m=new Date,p=m.getUTCDate(),h=m.getUTCMonth()+1,g=m.getUTCFullYear(),f=new Date(c),w=(new Date(l).getTime()-f.getTime())/864e5;console.log("Trip length:",w,"day(s)"),console.log("Fetching weather for your departure date..."),u-h>=0&&s-p>=0&&y-g>=0&&w>=0?s-p<=7?(!async function(e,t){a(`https://api.weatherbit.io/v2.0/current?&city=${e}${r}`).then((e=>{o("/add",{date:e.data[0].ob_time,city:e.data[0].city_name,state:e.data[0].state_code,country:e.data[0].country_code,weather:e.data[0].weather.description,temp:e.data[0].temp.toFixed(0),trip:t}),i(),d()}))}(t,w),console.log("Current weather"),n(t)):(!async function(e,t,n){a(`https://api.weatherbit.io/v2.0/forecast/daily?&city=${e}${r}`).then((e=>{for(let a=0;a<e.data.length;a++)e.data[a].datetime===t&&(o("/add",{date:e.data[a].datetime,city:e.city_name,state:e.state_code,country:e.country_code,weather:e.data[a].weather.description,temp:e.data[a].temp.toFixed(0),trip:n}),i(),d());const a=[];for(let t=0;t<e.data.length;t++)a.push(e.data[t].datetime);a.includes(t)||(alert("Sorry! Your departure date exceed the weather forecast.\nPlease insert a closer date to have the forecast."),i())}))}(t,c,w),console.log("Future weather"),n(t)):(alert("You can't travel in the past!\nAre you Martin McFly?"),console.log("Error with your input. Please insert a valid date to proced!"))}function d(){a("/all").then((e=>{console.log("Updating UI...");const t=document.createDocumentFragment(),a=document.getElementById("weather_data");document.getElementsByTagName("footer");let n=0;for(let a of Object.keys(e)){const o=document.createElement("div");o.setAttribute("class","fetch"),o.setAttribute("id",a),o.innerHTML=`${a}: ${Object.values(e)[n]}`,t.appendChild(o),n++}a.appendChild(t),console.log("UI updated!")}))}function i(){const e=document.getElementsByClassName("fetch");for(let t of e)t.innerHTML=""}window.addEventListener("load",(e=>{document.getElementById("inputs").addEventListener("submit",c)})),Client=t})();