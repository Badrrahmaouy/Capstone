var Client;(()=>{"use strict";var e={d:(t,a)=>{for(var o in a)e.o(a,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:a[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};async function a(e){const t=await fetch(e);try{return await t.json()}catch(e){console.log("error",e)}}e.r(t),e.d(t,{formHandler:()=>d});async function o(e){a("https://pixabay.com/api/?key=20560827-2583a0c3f9bf9a098c0a43c8e&q="+e+"&image_type=photo").then((e=>{const t=e.hits[0].webformatURL;document.getElementById("img").src=t}))}async function n(e="",t={}){const a=await fetch(e,{method:"POST",credentials:"same-origin",headers:{"Content-type":"application/json"},body:JSON.stringify(t)});try{return await a.json()}catch(e){console.log("error",e)}}const r="&key=6ee45688665343cfaaea8d2cd299528a";function d(e){e.preventDefault(),console.log(":::FORM SUBMITTED:::");let t=document.getElementById("address").value;const d=document.getElementById("date_dep").value,s=document.getElementById("date_ret").value,i=parseInt(d[8]+d[9]),u=parseInt(d[5]+d[6]),h=parseInt(d[0]+d[1]+d[2]+d[3]),m=new Date,p=m.getUTCDate(),g=m.getUTCMonth()+1,y=m.getUTCFullYear(),f=new Date(d),w=(new Date(s).getTime()-f.getTime())/864e5;console.log("Trip length:",w,"day(s)"),console.log("Fetching coordinates from GeoNames API..."),a("https://api.geonames.org/geoCodeAddressJSON?q="+t+"&username=badrrahmaouy").then((e=>{const t={lat:e.address.lat,lng:e.address.lng};return console.log("Coordinates fetched!"),t})).then((e=>{console.log("Fetching weather for your departure date..."),u-g>=0&&i-p>=0&&h-y>=0&&w>=0?i-p<=7?(!async function(e,t){a(`https://api.weatherbit.io/v2.0/current?lat=${e.lat}&lon=${e.lng}${r}`).then((e=>{n("https://localhost:8081/add",{date:e.data[0].ob_time,city:e.data[0].city_name,state:e.data[0].state_code,country:e.data[0].country_code,weather:e.data[0].weather.description,temp:e.data[0].temp.toFixed(0),trip:t}),l(),c()}))}(e,w),console.log("Current weather"),o(t)):(!async function(e,t,o){a(`https://api.weatherbit.io/v2.0/forecast/daily?lat=${e.lat}&lon=${e.lng}${r}`).then((e=>{for(let a=0;a<e.data.length;a++)e.data[a].datetime===t&&(n("https://localhost:8081/add",{date:e.data[a].datetime,city:e.city_name,state:e.state_code,country:e.country_code,weather:e.data[a].weather.description,temp:e.data[a].temp.toFixed(0),trip:o}),l(),c());const a=[];for(let t=0;t<e.data.length;t++)a.push(e.data[t].datetime);a.includes(t)||(alert("Sorry! Your departure date exceed the weather forecast.\nPlease insert a closer date to have the forecast."),l())}))}(e,d,w),console.log("Future weather"),o(t)):(alert("You can't travel in the past!\nAre you Martin McFly?"),console.log("Error with your input. Please insert a valid date to proced!"))}))}function c(){a("https://localhost:8081/all").then((e=>{console.log("Updating UI...");const t=document.createDocumentFragment(),a=document.getElementById("weather_data");document.getElementsByTagName("footer");let o=0;for(let a of Object.keys(e)){const n=document.createElement("div");n.setAttribute("class","fetch"),n.setAttribute("id",a),n.innerHTML=`${a}: ${Object.values(e)[o]}`,t.appendChild(n),o++}a.appendChild(t),console.log("UI updated!")}))}function l(){const e=document.getElementsByClassName("fetch");for(let t of e)t.innerHTML=""}window.addEventListener("load",(e=>{document.getElementById("inputs").addEventListener("submit",d)})),Client=t})();